<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Книги</title>
</head>
<body>
<h1>Список книг</h1>
<table id="books-table" style="border: 2px solid black; border-collapse: collapse;">
  <thead>
    <tr>
      <th style="border: 1px solid black">№</th>
      <th style="border: 1px solid black">Описание</th>
      <th style="border: 1px solid black">Автор</th>
      <th style="border: 1px solid black">Жанры</th>
      <th style="border: 1px solid black">Действия</th>
    </tr>
  </thead>
  <tbody id="books-tbody">
  </tbody>
</table>

<div style="margin-top: 20px;">
  <a href="/book/create" style="text-decoration: none;">
    <button style="padding: 10px 15px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">
      Создать книгу
    </button>
  </a>
</div>
<div style="margin-top: 20px;">
  <a href="/authors" style="text-decoration: none;">
    <button style="padding: 10px 15px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">
      Список авторов
    </button>
  </a>
</div>

<div style="margin-top: 20px;">
  <a href="/genres" style="text-decoration: none;">
    <button style="padding: 10px 15px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">
      Список жанров
    </button>
  </a>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    loadBooks();
  });

  function loadBooks() {
    fetch('/api/v1/book')
      .then(response => response.json())
      .then(books => {
        renderBooks(books);
      });
  }

  function renderBooks(books) {
    const tbody = document.getElementById('books-tbody');
    tbody.innerHTML = '';

    books.forEach((book, index) => {
      const row = document.createElement('tr');

      const genres = book.genres.map(g => g.name).join(', ');

      row.innerHTML = `
        <td style="border: 1px solid black">${index + 1}</td>
        <td style="border: 1px solid black">${book.title}</td>
        <td style="border: 1px solid black">${book.author.fullName}</td>
        <td style="border: 1px solid black; padding: 8px;">${genres}</td>
        <td style="border: 1px solid black; text-align: center;">
          <a href="/book/${book.id}/edit" style="text-decoration: none;">
            <button style="padding: 5px 10px; background-color: #2196F3; color: white; border: none; border-radius: 3px; cursor: pointer;">
              Редактировать
            </button>
          </a>
          <button onclick="deleteBook('${book.id}')" style="padding: 5px 10px; background-color: #f44336; color: white; border: none; border-radius: 3px; cursor: pointer;">
            Удалить
          </button>
          <a href="/book/${book.id}/info" style="text-decoration: none;">
            <button style="padding: 5px 10px; background-color: green; color: white; border: none; border-radius: 3px; cursor: pointer;">
              Информация
            </button>
          </a>
        </td>
      `;

      tbody.appendChild(row);
    });
  }

  function deleteBook(id) {
    fetch(`/api/v1/book/${id}`, {
      method: 'DELETE'
    })
      .then(response => {
        loadBooks();
      });
  }
</script>

</body>
</html>